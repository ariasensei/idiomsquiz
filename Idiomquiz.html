<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Idiom Quiz Challenge - Levels 1-4</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header h2 {
            color: #764ba2;
            font-size: 1.3rem;
            margin-bottom: 20px;
        }

        .quiz-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            display: block;
        }

        .quiz-menu {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .quiz-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .quiz-type-card {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 5px solid;
            position: relative;
            overflow: hidden;
        }

        .quiz-type-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .quiz-type-card.beginner { border-left-color: #4CAF50; }
        .quiz-type-card.intermediate { border-left-color: #FF9800; }
        .quiz-type-card.advanced { border-left-color: #E91E63; }
        .quiz-type-card.master { border-left-color: #9C27B0; }

        .quiz-type-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .quiz-type-card.beginner .quiz-type-title { color: #4CAF50; }
        .quiz-type-card.intermediate .quiz-type-title { color: #FF9800; }
        .quiz-type-card.advanced .quiz-type-title { color: #E91E63; }
        .quiz-type-card.master .quiz-type-title { color: #9C27B0; }

        .quiz-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .quiz-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #888;
        }

        .quiz-page {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .quiz-page.active {
            display: block;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .quiz-info h2 {
            color: #667eea;
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .quiz-progress {
            background: #f0f0f0;
            border-radius: 10px;
            height: 20px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(45deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .question-card {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }

        .question-number {
            color: #764ba2;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .option:hover {
            border-color: #667eea;
            background: #f0f5ff;
        }

        .option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .option.correct {
            border-color: #4CAF50;
            background: #4CAF50;
            color: white;
        }

        .option.incorrect {
            border-color: #f44336;
            background: #f44336;
            color: white;
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #764ba2;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a3a7a;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .results-page {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .results-page.active {
            display: block;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: white;
        }

        .score-excellent { background: linear-gradient(45deg, #4CAF50, #45a049); }
        .score-good { background: linear-gradient(45deg, #FF9800, #f57c00); }
        .score-fair { background: linear-gradient(45deg, #2196F3, #1976d2); }
        .score-poor { background: linear-gradient(45deg, #f44336, #d32f2f); }

        .results-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }

        .result-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .result-label {
            color: #666;
            margin-top: 5px;
        }

        .fill-blank-input {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            font-size: 1rem;
            margin: 0 5px;
            min-width: 150px;
            text-align: center;
        }

        .fill-blank-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .matching-column h4 {
            color: #667eea;
            margin-bottom: 15px;
            text-align: center;
        }

        .matching-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .matching-item:hover {
            border-color: #667eea;
            background: #f0f5ff;
        }

        .matching-item.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .matching-item.matched {
            border-color: #4CAF50;
            background: #4CAF50;
            color: white;
            cursor: default;
        }

        .timer-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            font-family: 'Courier New', monospace;
        }

        .explanation {
            background: #e8f5e8;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .explanation.show {
            display: block;
        }

        .explanation h4 {
            color: #2e7d32;
            margin-bottom: 8px;
        }

        .footer {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-top: 30px;
        }

        .footer-info {
            color: #666;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .website-link {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
            font-size: 1rem;
        }

        .website-link:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .quiz-types {
                grid-template-columns: 1fr;
            }
            
            .matching-container {
                grid-template-columns: 1fr;
            }
            
            .quiz-controls {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 style="color: #764ba2; font-size: 2rem; margin-bottom: 15px;">📚 Aria's Learning Hub</h1>
            <h1>🧠 Ultimate Idiom Quiz Challenge</h1>
            <h2>Test Your Knowledge Across All 4 Levels</h2>
            <div class="quiz-stats">
                <div class="stat-card">
                    <span class="stat-number">200+</span>
                    <span>Questions</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">6</span>
                    <span>Quiz Types</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">4</span>
                    <span>Difficulty Levels</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number">100</span>
                    <span>Unique Idioms</span>
                </div>
            </div>
        </div>

        <div class="quiz-menu" id="quizMenu">
            <h2 style="text-align: center; color: #667eea; margin-bottom: 30px;">Choose Your Challenge</h2>
            <div class="quiz-types">
                <div class="quiz-type-card beginner" onclick="startQuiz('multiple-choice', 'beginner')">
                    <div class="quiz-type-title">🌱 Multiple Choice Basics</div>
                    <div class="quiz-description">Perfect for beginners! Choose the correct meaning from 4 options. Covers fundamental idioms from Levels 1-2.</div>
                    <div class="quiz-details">
                        <span>📚 Levels 1-2</span>
                        <span>⏱️ 15 minutes</span>
                        <span>❓ 20 questions</span>
                    </div>
                </div>

                <div class="quiz-type-card intermediate" onclick="startQuiz('fill-blank', 'intermediate')">
                    <div class="quiz-type-title">📝 Fill in the Blanks</div>
                    <div class="quiz-description">Complete sentences with the correct idiom. Tests your understanding of context and usage from Levels 2-3.</div>
                    <div class="quiz-details">
                        <span>📚 Levels 2-3</span>
                        <span>⏱️ 20 minutes</span>
                        <span>❓ 15 questions</span>
                    </div>
                </div>

                <div class="quiz-type-card advanced" onclick="startQuiz('matching', 'advanced')">
                    <div class="quiz-type-title">🔗 Matching Challenge</div>
                    <div class="quiz-description">Match idioms with their meanings. Advanced level covering sophisticated expressions from Levels 3-4.</div>
                    <div class="quiz-details">
                        <span>📚 Levels 3-4</span>
                        <span>⏱️ 12 minutes</span>
                        <span>❓ 12 pairs</span>
                    </div>
                </div>

                <div class="quiz-type-card master" onclick="startQuiz('context', 'master')">
                    <div class="quiz-type-title">🎭 Context Master</div>
                    <div class="quiz-description">Identify idioms used in complex scenarios. Master level covering all levels with real-world applications.</div>
                    <div class="quiz-details">
                        <span>📚 All Levels</span>
                        <span>⏱️ 25 minutes</span>
                        <span>❓ 18 questions</span>
                    </div>
                </div>

                <div class="quiz-type-card beginner" onclick="startQuiz('true-false', 'beginner')">
                    <div class="quiz-type-title">✅ True or False</div>
                    <div class="quiz-description">Quick-fire true/false questions about idiom meanings and usage. Great for rapid review!</div>
                    <div class="quiz-details">
                        <span>📚 Levels 1-3</span>
                        <span>⏱️ 10 minutes</span>
                        <span>❓ 25 questions</span>
                    </div>
                </div>

                <div class="quiz-type-card master" onclick="startQuiz('mixed', 'master')">
                    <div class="quiz-type-title">🏆 Ultimate Challenge</div>
                    <div class="quiz-description">Mixed question types covering all levels. The ultimate test of your idiom mastery!</div>
                    <div class="quiz-details">
                        <span>📚 All Levels</span>
                        <span>⏱️ 30 minutes</span>
                        <span>❓ 30 questions</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="quiz-page" id="quizPage">
            <!-- Quiz content will be generated by JavaScript -->
        </div>

        <div class="results-page" id="resultsPage">
            <!-- Results will be generated by JavaScript -->
        </div>
    </div>

    <div class="footer">
        <div class="footer-info">Made by Aria • Teaching since 2014</div>
        <a href="https://ariasensei.github.io/teacheraria/" class="website-link" target="_blank">
            🌐 Visit Website: ariasensei.github.io/teacheraria/
        </a>
    </div>

    <script>
        // Comprehensive idiom database
        const idiomDatabase = {
            level1: [
                { idiom: "Break a leg", meaning: "Good luck", example: "Break a leg in your performance tonight!" },
                { idiom: "Piece of cake", meaning: "Very easy", example: "The math test was a piece of cake." },
                { idiom: "Hit the books", meaning: "Study hard", example: "I need to hit the books for my exam." },
                { idiom: "Spill the beans", meaning: "Reveal a secret", example: "Don't spill the beans about the surprise party." },
                { idiom: "Under the weather", meaning: "Feeling sick", example: "I'm feeling under the weather today." },
                { idiom: "Cost an arm and a leg", meaning: "Very expensive", example: "That car costs an arm and a leg." },
                { idiom: "It's raining cats and dogs", meaning: "Raining heavily", example: "We can't go out - it's raining cats and dogs." },
                { idiom: "Time flies", meaning: "Time passes quickly", example: "Time flies when you're having fun." },
                { idiom: "Don't cry over spilled milk", meaning: "Don't worry about past mistakes", example: "You failed the test, but don't cry over spilled milk." },
                { idiom: "The ball is in your court", meaning: "It's your turn to act", example: "I've made my offer, now the ball is in your court." }
            ],
            level2: [
                { idiom: "Break the ice", meaning: "Start a conversation", example: "He told a joke to break the ice at the meeting." },
                { idiom: "Bite off more than you can chew", meaning: "Take on too much", example: "Taking five classes might be biting off more than you can chew." },
                { idiom: "Get cold feet", meaning: "Become nervous or scared", example: "She got cold feet before her wedding." },
                { idiom: "Kill two birds with one stone", meaning: "Accomplish two things at once", example: "I'll visit the bank and grocery store to kill two birds with one stone." },
                { idiom: "Let the cat out of the bag", meaning: "Reveal a secret accidentally", example: "He let the cat out of the bag about the surprise." },
                { idiom: "Once in a blue moon", meaning: "Very rarely", example: "We only see each other once in a blue moon." },
                { idiom: "Pull someone's leg", meaning: "Tease or joke with someone", example: "I was just pulling your leg about the ghost story." },
                { idiom: "When pigs fly", meaning: "Never", example: "He'll clean his room when pigs fly." },
                { idiom: "A blessing in disguise", meaning: "Something good that seemed bad at first", example: "Losing that job was a blessing in disguise." },
                { idiom: "Better late than never", meaning: "It's better to do something late than not at all", example: "You're an hour late, but better late than never." }
            ],
            level3: [
                { idiom: "Cut corners", meaning: "Do something cheaply or carelessly", example: "The company cut corners on safety measures." },
                { idiom: "Think outside the box", meaning: "Think creatively", example: "We need to think outside the box to solve this problem." },
                { idiom: "Touch base", meaning: "Make contact briefly", example: "Let me touch base with the client tomorrow." },
                { idiom: "Move the needle", meaning: "Make a significant impact", example: "This strategy should move the needle on sales." },
                { idiom: "Low-hanging fruit", meaning: "Easy targets or tasks", example: "Let's focus on the low-hanging fruit first." },
                { idiom: "Meet someone halfway", meaning: "Compromise", example: "I'll meet you halfway on the price." },
                { idiom: "Drive a hard bargain", meaning: "Negotiate firmly", example: "She drives a hard bargain in business deals." },
                { idiom: "Sweeten the deal", meaning: "Make an offer more attractive", example: "They sweetened the deal with free shipping." },
                { idiom: "Twist someone's arm", meaning: "Persuade someone reluctantly", example: "I had to twist his arm to get him to help." },
                { idiom: "Seal the deal", meaning: "Finalize an agreement", example: "We sealed the deal with a handshake." }
            ],
            level4: [
                { idiom: "Rub shoulders with", meaning: "Associate with important people", example: "At the gala, she rubbed shoulders with celebrities." },
                { idiom: "Pull strings", meaning: "Use influence to get something done", example: "He pulled strings to get his son the job." },
                { idiom: "Burn bridges", meaning: "Destroy relationships", example: "Don't burn bridges with your former employer." },
                { idiom: "Cross the Rubicon", meaning: "Pass a point of no return", example: "When he quit, he crossed the Rubicon." },
                { idiom: "Devil's advocate", meaning: "Argue against an idea to test it", example: "Let me play devil's advocate here." },
                { idiom: "Food for thought", meaning: "Something worth considering", example: "The lecture gave us food for thought." },
                { idiom: "Ivory tower", meaning: "Academic isolation from reality", example: "The policy was created in an ivory tower." },
                { idiom: "Split hairs", meaning: "Argue about trivial differences", example: "Stop splitting hairs over minor details." },
                { idiom: "Paradigm shift", meaning: "Fundamental change in approach", example: "AI represents a paradigm shift in technology." },
                { idiom: "Achilles' heel", meaning: "A person's main weakness", example: "Perfectionism is his Achilles' heel." }
            ]
        };

        // Quiz state
        let currentQuiz = null;
        let currentQuestion = 0;
        let score = 0;
        let answers = [];
        let timeLeft = 0;
        let timerInterval = null;
        let selectedMatches = [];

        // Quiz generators
        function generateMultipleChoiceQuiz(difficulty) {
            const questions = [];
            let idioms = [];
            
            if (difficulty === 'beginner') {
                idioms = [...idiomDatabase.level1, ...idiomDatabase.level2.slice(0, 5)];
            } else if (difficulty === 'intermediate') {
                idioms = [...idiomDatabase.level2, ...idiomDatabase.level3.slice(0, 5)];
            } else {
                idioms = [...idiomDatabase.level3, ...idiomDatabase.level4];
            }

            const shuffled = shuffleArray(idioms).slice(0, 20);
            
            shuffled.forEach((item, index) => {
                const wrongAnswers = getRandomWrongAnswers(item.meaning, idioms, 3);
                const options = shuffleArray([item.meaning, ...wrongAnswers]);
                
                questions.push({
                    type: 'multiple-choice',
                    question: `What does "${item.idiom}" mean?`,
                    options: options,
                    correct: item.meaning,
                    explanation: `"${item.idiom}" means ${item.meaning}. Example: ${item.example}`
                });
            });
            
            return questions;
        }

        function generateFillBlankQuiz(difficulty) {
            const questions = [];
            let idioms = [];
            
            if (difficulty === 'intermediate') {
                idioms = [...idiomDatabase.level2, ...idiomDatabase.level3];
            } else {
                idioms = [...idiomDatabase.level3, ...idiomDatabase.level4];
            }

            const shuffled = shuffleArray(idioms).slice(0, 15);
            
            shuffled.forEach(item => {
                const words = item.idiom.split(' ');
                const blankIndex = Math.floor(Math.random() * words.length);
                const blankWord = words[blankIndex];
                words[blankIndex] = '____';
                const questionText = words.join(' ');
                
                questions.push({
                    type: 'fill-blank',
                    question: `Complete the idiom: "${questionText}"`,
                    context: `Meaning: ${item.meaning}`,
                    correct: blankWord.toLowerCase(),
                    explanation: `The complete idiom is "${item.idiom}" which means ${item.meaning}.`
                });
            });
            
            return questions;
        }

        function generateMatchingQuiz(difficulty) {
            let idioms = [];
            
            if (difficulty === 'advanced') {
                idioms = [...idiomDatabase.level3, ...idiomDatabase.level4];
            } else {
                idioms = [...idiomDatabase.level1, ...idiomDatabase.level2];
            }

            const selected = shuffleArray(idioms).slice(0, 12);
            
            return [{
                type: 'matching',
                question: 'Match each idiom with its correct meaning:',
                idioms: shuffleArray(selected.map(item => item.idiom)),
                meanings: shuffleArray(selected.map(item => item.meaning)),
                pairs: selected.map(item => ({ idiom: item.idiom, meaning: item.meaning }))
            }];
        }

        function generateContextQuiz(difficulty) {
            const questions = [];
            let idioms = [];
            
            if (difficulty === 'master') {
                idioms = [...idiomDatabase.level1, ...idiomDatabase.level2, ...idiomDatabase.level3, ...idiomDatabase.level4];
            }

            const shuffled = shuffleArray(idioms).slice(0, 18);
            
            shuffled.forEach(item => {
                const scenarios = [
                    `In a business meeting, someone said: "${item.example}" Which idiom were they using?`,
                    `Read this sentence: "${item.example}" What does the highlighted expression mean?`,
                    `Context: ${item.example} The idiom used here means:`,
                    `Someone used this expression: "${item.example}" They were trying to say:`
                ];
                
                const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
                const wrongAnswers = getRandomWrongAnswers(item.meaning, idioms, 3);
                const options = shuffleArray([item.meaning, ...wrongAnswers]);
                
                questions.push({
                    type: 'context',
                    question: scenario,
                    options: options,
                    correct: item.meaning,
                    idiom: item.idiom,
                    explanation: `The idiom "${item.idiom}" means ${item.meaning}.`
                });
            });
            
            return questions;
        }

        function generateTrueFalseQuiz(difficulty) {
            const questions = [];
            let idioms = [];
            
            if (difficulty === 'beginner') {
                idioms = [...idiomDatabase.level1, ...idiomDatabase.level2, ...idiomDatabase.level3.slice(0, 5)];
            }

            const shuffled = shuffleArray(idioms).slice(0, 25);
            
            shuffled.forEach(item => {
                const isTrue = Math.random() > 0.5;
                let statement, correct;
                
                if (isTrue) {
                    statement = `"${item.idiom}" means ${item.meaning}.`;
                    correct = 'True';
                } else {
                    const wrongMeaning = getRandomWrongAnswers(item.meaning, idioms, 1)[0];
                    statement = `"${item.idiom}" means ${wrongMeaning}.`;
                    correct = 'False';
                }
                
                questions.push({
                    type: 'true-false',
                    question: statement,
                    options: ['True', 'False'],
                    correct: correct,
                    explanation: `"${item.idiom}" actually means ${item.meaning}.`
                });
            });
            
            return questions;
        }

        function generateMixedQuiz(difficulty) {
            const questions = [];
            
            // Mix of different question types
            questions.push(...generateMultipleChoiceQuiz('intermediate').slice(0, 10));
            questions.push(...generateFillBlankQuiz('advanced').slice(0, 8));
            questions.push(...generateContextQuiz('master').slice(0, 7));
            questions.push(...generateTrueFalseQuiz('beginner').slice(0, 5));
            
            return shuffleArray(questions).slice(0, 30);
        }

        // Utility functions
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function getRandomWrongAnswers(correctAnswer, allIdioms, count) {
            const wrongAnswers = allIdioms
                .map(item => item.meaning)
                .filter(meaning => meaning !== correctAnswer);
            
            return shuffleArray(wrongAnswers).slice(0, count);
        }

        function startQuiz(type, difficulty) {
            let questions = [];
            let timeLimit = 15; // minutes
            
            switch (type) {
                case 'multiple-choice':
                    questions = generateMultipleChoiceQuiz(difficulty);
                    timeLimit = 15;
                    break;
                case 'fill-blank':
                    questions = generateFillBlankQuiz(difficulty);
                    timeLimit = 20;
                    break;
                case 'matching':
                    questions = generateMatchingQuiz(difficulty);
                    timeLimit = 12;
                    break;
                case 'context':
                    questions = generateContextQuiz(difficulty);
                    timeLimit = 25;
                    break;
                case 'true-false':
                    questions = generateTrueFalseQuiz(difficulty);
                    timeLimit = 10;
                    break;
                case 'mixed':
                    questions = generateMixedQuiz(difficulty);
                    timeLimit = 30;
                    break;
            }
            
            currentQuiz = {
                type: type,
                difficulty: difficulty,
                questions: questions,
                timeLimit: timeLimit
            };
            
            currentQuestion = 0;
            score = 0;
            answers = [];
            timeLeft = timeLimit * 60;
            selectedMatches = [];
            
            showQuizPage();
            startTimer();
            displayQuestion();
        }

        function showQuizPage() {
            document.getElementById('quizMenu').style.display = 'none';
            document.getElementById('quizPage').style.display = 'block';
            document.getElementById('resultsPage').style.display = 'none';
        }

        function showResults() {
            document.getElementById('quizMenu').style.display = 'none';
            document.getElementById('quizPage').style.display = 'none';
            document.getElementById('resultsPage').style.display = 'block';
            
            clearInterval(timerInterval);
            displayResults();
        }

        function showMenu() {
            document.getElementById('quizMenu').style.display = 'block';
            document.getElementById('quizPage').style.display = 'none';
            document.getElementById('resultsPage').style.display = 'none';
            
            clearInterval(timerInterval);
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    showResults();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const display = document.getElementById('timerDisplay');
            if (display) {
                display.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function displayQuestion() {
            const question = currentQuiz.questions[currentQuestion];
            const progress = ((currentQuestion + 1) / currentQuiz.questions.length) * 100;
            
            let questionHTML = `
                <div class="quiz-header">
                    <div class="quiz-info">
                        <h2>${getQuizTitle(currentQuiz.type)} - ${currentQuiz.difficulty.charAt(0).toUpperCase() + currentQuiz.difficulty.slice(1)}</h2>
                        <p>Question ${currentQuestion + 1} of ${currentQuiz.questions.length}</p>
                    </div>
                    <div class="timer-display" id="timerDisplay">${Math.floor(timeLeft / 60)}:${(timeLeft % 60).toString().padStart(2, '0')}</div>
                </div>
                
                <div class="quiz-progress">
                    <div class="progress-bar" style="width: ${progress}%">${Math.round(progress)}%</div>
                </div>
            `;
            
            if (question.type === 'matching') {
                questionHTML += displayMatchingQuestion(question);
            } else {
                questionHTML += displayRegularQuestion(question);
            }
            
            document.getElementById('quizPage').innerHTML = questionHTML;
        }

        function displayRegularQuestion(question) {
            let questionHTML = `
                <div class="question-card">
                    <div class="question-number">Question ${currentQuestion + 1}</div>
                    <div class="question-text">${question.question}</div>
                    ${question.context ? `<p style="color: #666; font-style: italic;">${question.context}</p>` : ''}
            `;
            
            if (question.type === 'fill-blank') {
                questionHTML += `
                    <div style="margin: 20px 0;">
                        <input type="text" class="fill-blank-input" id="blankAnswer" placeholder="Enter your answer">
                    </div>
                `;
            } else {
                questionHTML += `<div class="options">`;
                question.options.forEach((option, index) => {
                    questionHTML += `
                        <div class="option" onclick="selectOption(${index})" id="option${index}">
                            ${option}
                        </div>
                    `;
                });
                questionHTML += `</div>`;
            }
            
            questionHTML += `
                </div>
                <div class="explanation" id="explanation">
                    <h4>Explanation:</h4>
                    <p>${question.explanation}</p>
                </div>
                <div class="quiz-controls">
                    <button class="btn btn-secondary" onclick="showMenu()">← Back to Menu</button>
                    <button class="btn btn-primary" onclick="submitAnswer()" id="submitBtn">Submit Answer</button>
                </div>
            `;
            
            return questionHTML;
        }

        function displayMatchingQuestion(question) {
            return `
                <div class="question-card">
                    <div class="question-number">Matching Challenge</div>
                    <div class="question-text">${question.question}</div>
                    <div class="matching-container">
                        <div class="matching-column">
                            <h4>Idioms</h4>
                            ${question.idioms.map((idiom, index) => `
                                <div class="matching-item" onclick="selectIdiom(${index})" id="idiom${index}">
                                    ${idiom}
                                </div>
                            `).join('')}
                        </div>
                        <div class="matching-column">
                            <h4>Meanings</h4>
                            ${question.meanings.map((meaning, index) => `
                                <div class="matching-item" onclick="selectMeaning(${index})" id="meaning${index}">
                                    ${meaning}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                <div class="quiz-controls">
                    <button class="btn btn-secondary" onclick="showMenu()">← Back to Menu</button>
                    <button class="btn btn-primary" onclick="submitMatching()" id="submitBtn">Submit Matches</button>
                </div>
            `;
        }

        function getQuizTitle(type) {
            const titles = {
                'multiple-choice': 'Multiple Choice Quiz',
                'fill-blank': 'Fill in the Blanks',
                'matching': 'Matching Challenge',
                'context': 'Context Master',
                'true-false': 'True or False',
                'mixed': 'Ultimate Challenge'
            };
            return titles[type] || 'Quiz';
        }

        let selectedOption = null;
        let selectedIdiomIndex = null;
        let selectedMeaningIndex = null;

        function selectOption(index) {
            // Clear previous selection
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            
            // Select new option
            document.getElementById(`option${index}`).classList.add('selected');
            selectedOption = index;
        }

        function selectIdiom(index) {
            // Clear previous idiom selection
            document.querySelectorAll('[id^="idiom"]').forEach(item => item.classList.remove('selected'));
            
            // Select new idiom
            document.getElementById(`idiom${index}`).classList.add('selected');
            selectedIdiomIndex = index;
            
            // If both idiom and meaning are selected, try to match
            if (selectedMeaningIndex !== null) {
                tryMatch();
            }
        }

        function selectMeaning(index) {
            // Clear previous meaning selection
            document.querySelectorAll('[id^="meaning"]').forEach(item => item.classList.remove('selected'));
            
            // Select new meaning
            document.getElementById(`meaning${index}`).classList.add('selected');
            selectedMeaningIndex = index;
            
            // If both idiom and meaning are selected, try to match
            if (selectedIdiomIndex !== null) {
                tryMatch();
            }
        }

        function tryMatch() {
            const question = currentQuiz.questions[currentQuestion];
            const selectedIdiom = question.idioms[selectedIdiomIndex];
            const selectedMeaning = question.meanings[selectedMeaningIndex];
            
            // Check if this is a correct match
            const isCorrect = question.pairs.some(pair => 
                pair.idiom === selectedIdiom && pair.meaning === selectedMeaning
            );
            
            if (isCorrect) {
                // Mark as matched
                document.getElementById(`idiom${selectedIdiomIndex}`).classList.add('matched');
                document.getElementById(`meaning${selectedMeaningIndex}`).classList.add('matched');
                
                selectedMatches.push({
                    idiom: selectedIdiom,
                    meaning: selectedMeaning,
                    correct: true
                });
                
                // Remove click handlers for matched items
                document.getElementById(`idiom${selectedIdiomIndex}`).onclick = null;
                document.getElementById(`meaning${selectedMeaningIndex}`).onclick = null;
            }
            
            // Reset selections
            selectedIdiomIndex = null;
            selectedMeaningIndex = null;
            
            // Clear visual selections
            document.querySelectorAll('.matching-item.selected').forEach(item => {
                if (!item.classList.contains('matched')) {
                    item.classList.remove('selected');
                }
            });
        }

        function submitAnswer() {
            const question = currentQuiz.questions[currentQuestion];
            let userAnswer = null;
            let isCorrect = false;
            
            if (question.type === 'fill-blank') {
                userAnswer = document.getElementById('blankAnswer').value.trim().toLowerCase();
                isCorrect = userAnswer === question.correct;
            } else {
                if (selectedOption !== null) {
                    userAnswer = question.options[selectedOption];
                    isCorrect = userAnswer === question.correct;
                }
            }
            
            // Show correct answer
            if (question.type !== 'fill-blank') {
                document.querySelectorAll('.option').forEach((opt, index) => {
                    if (question.options[index] === question.correct) {
                        opt.classList.add('correct');
                    } else if (index === selectedOption && !isCorrect) {
                        opt.classList.add('incorrect');
                    }
                });
            }
            
            // Show explanation
            document.getElementById('explanation').classList.add('show');
            
            // Record answer
            answers.push({
                question: question.question,
                userAnswer: userAnswer,
                correctAnswer: question.correct,
                isCorrect: isCorrect
            });
            
            if (isCorrect) score++;
            
            // Update button
            const submitBtn = document.getElementById('submitBtn');
            if (currentQuestion < currentQuiz.questions.length - 1) {
                submitBtn.textContent = 'Next Question →';
                submitBtn.onclick = nextQuestion;
            } else {
                submitBtn.textContent = 'View Results';
                submitBtn.onclick = showResults;
            }
        }

        function submitMatching() {
            const question = currentQuiz.questions[currentQuestion];
            
            // Calculate score for matching
            const correctMatches = selectedMatches.filter(match => match.correct).length;
            const matchScore = correctMatches / question.pairs.length;
            
            answers.push({
                question: 'Matching Challenge',
                userAnswer: `${correctMatches}/${question.pairs.length} correct matches`,
                correctAnswer: `${question.pairs.length}/${question.pairs.length} matches`,
                isCorrect: matchScore >= 0.7 // 70% threshold for matching
            });
            
            if (matchScore >= 0.7) score++;
            
            // Show results or next question
            if (currentQuestion < currentQuiz.questions.length - 1) {
                nextQuestion();
            } else {
                showResults();
            }
        }

        function nextQuestion() {
            currentQuestion++;
            selectedOption = null;
            selectedMatches = [];
            displayQuestion();
        }

        function displayResults() {
            const percentage = Math.round((score / currentQuiz.questions.length) * 100);
            let scoreClass = 'score-poor';
            let message = 'Keep practicing!';
            
            if (percentage >= 90) {
                scoreClass = 'score-excellent';
                message = 'Outstanding! You\'re an idiom master!';
            } else if (percentage >= 75) {
                scoreClass = 'score-good';
                message = 'Great job! You have strong idiom knowledge!';
            } else if (percentage >= 60) {
                scoreClass = 'score-fair';
                message = 'Good effort! Keep studying to improve!';
            }
            
            const timeUsed = (currentQuiz.timeLimit * 60) - timeLeft;
            const minutesUsed = Math.floor(timeUsed / 60);
            const secondsUsed = timeUsed % 60;
            
            document.getElementById('resultsPage').innerHTML = `
                <h2 style="color: #667eea; margin-bottom: 30px;">Quiz Complete!</h2>
                
                <div class="score-circle ${scoreClass}">
                    ${percentage}%
                </div>
                
                <h3 style="color: #333; margin-bottom: 30px;">${message}</h3>
                
                <div class="results-details">
                    <div class="result-stat">
                        <div class="result-number">${score}</div>
                        <div class="result-label">Correct Answers</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-number">${currentQuiz.questions.length - score}</div>
                        <div class="result-label">Incorrect Answers</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-number">${minutesUsed}:${secondsUsed.toString().padStart(2, '0')}</div>
                        <div class="result-label">Time Used</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-number">${currentQuiz.questions.length}</div>
                        <div class="result-label">Total Questions</div>
                    </div>
                </div>
                
                <div style="margin: 30px 0;">
                    <button class="btn btn-primary" onclick="showMenu()" style="margin-right: 15px;">Try Another Quiz</button>
                    <button class="btn btn-secondary" onclick="retakeQuiz()">Retake This Quiz</button>
                </div>
                
                <div style="text-align: left; background: #f8f9ff; padding: 20px; border-radius: 15px; margin-top: 30px;">
                    <h4 style="color: #667eea; margin-bottom: 15px;">Performance Tips:</h4>
                    ${getPerformanceTips(percentage)}
                </div>
            `;
        }

        function getPerformanceTips(percentage) {
            if (percentage >= 90) {
                return `
                    <p>🌟 Excellent work! You've mastered these idioms. Consider:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Try the Ultimate Challenge for mixed question types</li>
                        <li>Practice using these idioms in real conversations</li>
                        <li>Help others learn by explaining idiom meanings</li>
                    </ul>
                `;
            } else if (percentage >= 75) {
                return `
                    <p>👍 Great job! To reach mastery level:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Review the idioms you missed</li>
                        <li>Practice with context-based questions</li>
                        <li>Try creating your own example sentences</li>
                    </ul>
                `;
            } else if (percentage >= 60) {
                return `
                    <p>📚 Good foundation! To improve:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Focus on basic multiple choice quizzes first</li>
                        <li>Study idiom meanings and examples carefully</li>
                        <li>Practice with easier levels before advancing</li>
                    </ul>
                `;
            } else {
                return `
                    <p>💪 Keep practicing! Suggestions:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>Start with Level 1-2 idioms</li>
                        <li>Use flashcards to memorize meanings</li>
                        <li>Read example sentences multiple times</li>
                        <li>Take your time with each question</li>
                    </ul>
                `;
            }
        }

        function retakeQuiz() {
            startQuiz(currentQuiz.type, currentQuiz.difficulty);
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Page is ready
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9759882fb27f0715',t:'MTc1NjI3NjM0OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
